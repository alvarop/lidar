#include <stdio.h>
#include <stdlib.h>
#include "bsp/bsp.h"
#include "console/console.h"
#include "hal/hal_gpio.h"
#include "os/os.h"
#include "sysinit/sysinit.h"
#include <hal/hal_spi.h>
#include "ws2812.h"

// Number of actual bytes it takes to encode WS2812 byte
#define BYTE_LEN (9)

// Last byte must be zero
static uint8_t pattern[BYTE_LEN * 3 * WS2812_NUM_PIXELS + 1];

// Look up table for all 256 bytes
static const uint8_t ws2812_lut[256][BYTE_LEN] = {
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xE0, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x70, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x38, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1C, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0E, 0x07, 0xC3, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0x03, 0xE1, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0x81, 0xF0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xC0, },
  {0xF8, 0x7C, 0x3E, 0x1F, 0x0F, 0x87, 0xC3, 0xE1, 0xF0, },
};

void ws2812_set_pixel(uint16_t pixel, uint8_t red, uint8_t green, uint8_t blue) {
    if (pixel < WS2812_NUM_PIXELS) {
        uint8_t *pixel_addr = &pattern[1 + pixel * BYTE_LEN * 3];
        memcpy(&pixel_addr[0], ws2812_lut[green], BYTE_LEN);
        memcpy(&pixel_addr[BYTE_LEN], ws2812_lut[red], BYTE_LEN);
        memcpy(&pixel_addr[BYTE_LEN * 2], ws2812_lut[blue], BYTE_LEN);
    }
}

static struct hal_spi_settings spi_settings = {
    .data_order = HAL_SPI_MSB_FIRST,
    .data_mode  = HAL_SPI_MODE0,
    .baudrate   = 8000,
    .word_size  = HAL_SPI_WORD_SIZE_8BIT,
};

void ws2812_write() {

  hal_spi_txrx(0, pattern ,NULL, sizeof(pattern)-1);

}

int ws2812_init(void){
    hal_spi_config(0, &spi_settings);
    hal_spi_enable(0);

    pattern[sizeof(pattern)] = 0;

    for(uint16_t pixel = 0; pixel < WS2812_NUM_PIXELS; pixel++) {
        ws2812_set_pixel(pixel, 0, 0 ,0);
    }

    ws2812_write();

    return 0;
}
